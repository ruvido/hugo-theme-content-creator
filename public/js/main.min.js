function initTheme(){const e=document.querySelector(".theme-toggle");e&&e.addEventListener("click",()=>{const t=document.documentElement.getAttribute("data-theme"),e=t==="light"?"dark":"light";document.documentElement.setAttribute("data-theme",e);try{localStorage.setItem("theme",e)}catch{}})}function initMobileMenu(){const e=document.querySelector(".mobile-menu-toggle"),t=document.querySelector(".nav-mobile");e&&t&&e.addEventListener("click",()=>{const n=e.classList.contains("active");e.classList.toggle("active"),e.setAttribute("aria-expanded",!n),t.style.display=t.style.display==="none"?"block":"none"})}function initSearch(){const e=document.querySelector(".search-toggle");if(!e)return;let t=!1;e.addEventListener("click",()=>{if(!t)try{loadSearchModule(),t=!0}catch{console.warn("Search failed to load")}})}function loadSearchModule(){const e=document.querySelector(".search-overlay"),t=document.querySelector(".search-input");if(!e||!t)return;e.style.display="block",t.focus(),document.body.style.overflow="hidden";const o=document.querySelector(".search-close"),n=document.querySelector(".search-results");function s(){e.style.display="none",document.body.style.overflow="",t.value="",n&&(n.innerHTML="")}o&&(o.onclick=s),e.onclick=t=>t.target===e&&s(),document.onkeydown=e=>e.key==="Escape"&&s();let i;t.oninput=e=>{clearTimeout(i),n&&(i=setTimeout(()=>{n.innerHTML=e.target.value.length>1?"<div>Ricerca in corso...</div>":""},300))}}function initLazyImages(){if(!("IntersectionObserver"in window))return;const e=document.querySelectorAll("img[data-src]");if(!e.length)return;const t=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const n=e.target;n.src=n.dataset.src,n.classList.remove("lazy"),t.unobserve(n)}})},{rootMargin:"50px"});e.forEach(e=>t.observe(e))}try{document.readyState==="loading"?document.addEventListener("DOMContentLoaded",initCritical):initCritical()}catch{}function initCritical(){try{initTheme(),initMobileMenu()}catch{}"requestIdleCallback"in window?requestIdleCallback(initNonCritical,{timeout:2e3}):setTimeout(initNonCritical,1e3)}function initNonCritical(){try{initSearch(),initLazyImages()}catch{}}