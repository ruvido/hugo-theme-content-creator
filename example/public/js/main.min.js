class ThemeManager{constructor(){this.cache=new Map,this.init()}getElement(e){return this.cache.has(e)||this.cache.set(e,document.querySelector(e)),this.cache.get(e)}init(){document.addEventListener("DOMContentLoaded",()=>this.initializeComponents(),{once:!0,passive:!0}),(document.readyState==="complete"||document.readyState==="interactive")&&this.initializeComponents()}initializeComponents(){try{this.initMobileMenu(),this.initLazyLoading()}catch(e){console.warn("Component initialization failed:",e)}}initMobileMenu(){const e=this.getElement(".mobile-menu-toggle"),n=this.getElement(".nav-mobile");if(!e||!n)return;let t=!1;const s=n.querySelectorAll(".nav-link");this.setMobileMenuState(e,n,s,!1);const o=o=>{o.preventDefault(),o.stopPropagation(),t=!t,this.setMobileMenuState(e,n,s,t);const i=t?"Chiudi menu di navigazione":"Apri menu di navigazione";e.setAttribute("aria-label",i)},i=o=>{o.key==="Escape"&&t&&(t=!1,this.setMobileMenuState(e,n,s,!1),e.focus()),t&&(o.key==="Tab"||o.key==="ArrowDown"||o.key==="ArrowUp")&&this.handleMenuKeyboardNavigation(o,s,e)},a=o=>{t&&!e.contains(o.target)&&!n.contains(o.target)&&(t=!1,this.setMobileMenuState(e,n,s,!1))},r=()=>{t=!1,this.setMobileMenuState(e,n,s,!1)};e.addEventListener("click",o,{passive:!1}),document.addEventListener("keydown",i),document.addEventListener("click",a),s.forEach(e=>{e.addEventListener("click",r)});const c=()=>{window.innerWidth>768&&t&&(t=!1,this.setMobileMenuState(e,n,s,!1))};window.addEventListener("resize",c,{passive:!0}),window.addEventListener("beforeunload",()=>{e.removeEventListener("click",o),document.removeEventListener("keydown",i),document.removeEventListener("click",a),window.removeEventListener("resize",c),s.forEach(e=>{e.removeEventListener("click",r)})},{once:!0})}setMobileMenuState(e,t,n,s){requestAnimationFrame(()=>{e.setAttribute("aria-expanded",s.toString()),e.classList.toggle("active",s),t.setAttribute("aria-hidden",(!s).toString()),s?(t.classList.add("mobile-menu-open"),n.forEach(e=>{e.removeAttribute("tabindex")}),n.length>0&&n[0].focus()):(t.classList.remove("mobile-menu-open"),n.forEach(e=>{e.setAttribute("tabindex","-1")}))})}handleMenuKeyboardNavigation(e,t,n){const o=Array.from(t).indexOf(document.activeElement);let s;switch(e.key){case"ArrowDown":e.preventDefault(),s=o+1,s>=t.length&&(s=0),t[s].focus();break;case"ArrowUp":e.preventDefault(),s=o-1,s<0&&(s=t.length-1),t[s].focus();break;case"Tab":e.shiftKey&&o===0?(e.preventDefault(),n.focus()):!e.shiftKey&&o===t.length-1&&(e.preventDefault(),n.focus());break}}initLazyLoading(){if(!("IntersectionObserver"in window))return;const e=document.querySelectorAll("img[data-src]");if(!e.length)return;const t=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const n=e.target;this.loadImage(n),t.unobserve(n)}})},{rootMargin:"50px 0px",threshold:.1});e.forEach(e=>t.observe(e))}loadImage(e){const t=new Image;t.onload=()=>{requestAnimationFrame(()=>{e.src=e.dataset.src,e.classList.remove("lazy"),e.classList.add("loaded")})},t.onerror=()=>{e.classList.add("error")},t.src=e.dataset.src}}new ThemeManager